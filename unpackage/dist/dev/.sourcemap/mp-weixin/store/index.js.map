{"version":3,"file":"index.js","sources":["store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\n\n// 从本地存储中获取初始状态\nconst getInitialState = () => {\n    const token = uni.getStorageSync('access_token')\n    const userInfo = uni.getStorageSync('user_info')\n    const userProfile = uni.getStorageSync('user_profile')\n\n    return {\n        isLoggedIn: !!token,\n        userInfo: userInfo || null,\n        userProfile: userProfile || null,\n        token: token || null\n    }\n}\n\nconst store = createStore({\n    state: getInitialState(),\n    mutations: {\n        setIsLoggedIn(state, status) {\n            state.isLoggedIn = status\n        },\n        setUserInfo(state, info) {\n            state.userInfo = info\n            uni.setStorageSync('user_info', info)\n        },\n        setUserProfile(state, profile) {\n            state.userProfile = profile\n            uni.setStorageSync('user_profile', profile)\n        },\n        setToken(state, token) {\n            state.token = token\n            uni.setStorageSync('access_token', token)\n        },\n        logout(state) {\n            state.isLoggedIn = false\n            state.userInfo = null\n            state.userProfile = null\n            state.token = null\n            uni.removeStorageSync('access_token')\n            uni.removeStorageSync('refresh_token')\n            uni.removeStorageSync('user_info')\n            uni.removeStorageSync('user_profile')\n        }\n    },\n    actions: {\n        async fetchUserProfile({ commit, state }) {\n            try {\n                const token = uni.getStorageSync('access_token')\n                if (!token) return\n\n                const response = await uni.request({\n                    url: 'http://localhost:8000/api/user/profile/',\n                    method: 'GET',\n                    header: {\n                        'Authorization': `Bearer ${token}`,\n                        'Accept': 'application/json'\n                    }\n                })\n\n                if (response.statusCode === 200) {\n                    commit('setUserProfile', response.data)\n                    uni.setStorageSync('user_profile', response.data)\n                }\n            } catch (error) {\n                console.error('获取用户信息失败:', error)\n            }\n        }\n    },\n    getters: {\n        isAuthenticated: state => state.isLoggedIn,\n        currentUser: state => state.userInfo,\n        userProfile: state => state.userProfile\n    }\n})\n\nexport default store "],"names":["uni","createStore"],"mappings":";;AAGA,MAAM,kBAAkB,MAAM;AAC1B,QAAM,QAAQA,cAAAA,MAAI,eAAe,cAAc;AAC/C,QAAM,WAAWA,cAAAA,MAAI,eAAe,WAAW;AAC/C,QAAM,cAAcA,cAAAA,MAAI,eAAe,cAAc;AAErD,SAAO;AAAA,IACH,YAAY,CAAC,CAAC;AAAA,IACd,UAAU,YAAY;AAAA,IACtB,aAAa,eAAe;AAAA,IAC5B,OAAO,SAAS;AAAA,EACnB;AACL;AAEK,MAAC,QAAQC,cAAAA,YAAY;AAAA,EACtB,OAAO,gBAAiB;AAAA,EACxB,WAAW;AAAA,IACP,cAAc,OAAO,QAAQ;AACzB,YAAM,aAAa;AAAA,IACtB;AAAA,IACD,YAAY,OAAO,MAAM;AACrB,YAAM,WAAW;AACjBD,0BAAI,eAAe,aAAa,IAAI;AAAA,IACvC;AAAA,IACD,eAAe,OAAO,SAAS;AAC3B,YAAM,cAAc;AACpBA,0BAAI,eAAe,gBAAgB,OAAO;AAAA,IAC7C;AAAA,IACD,SAAS,OAAO,OAAO;AACnB,YAAM,QAAQ;AACdA,0BAAI,eAAe,gBAAgB,KAAK;AAAA,IAC3C;AAAA,IACD,OAAO,OAAO;AACV,YAAM,aAAa;AACnB,YAAM,WAAW;AACjB,YAAM,cAAc;AACpB,YAAM,QAAQ;AACdA,oBAAG,MAAC,kBAAkB,cAAc;AACpCA,oBAAG,MAAC,kBAAkB,eAAe;AACrCA,oBAAG,MAAC,kBAAkB,WAAW;AACjCA,oBAAG,MAAC,kBAAkB,cAAc;AAAA,IACvC;AAAA,EACJ;AAAA,EACD,SAAS;AAAA,IACL,MAAM,iBAAiB,EAAE,QAAQ,SAAS;AACtC,UAAI;AACA,cAAM,QAAQA,cAAAA,MAAI,eAAe,cAAc;AAC/C,YAAI,CAAC;AAAO;AAEZ,cAAM,WAAW,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC/B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,QAAQ;AAAA,YACJ,iBAAiB,UAAU,KAAK;AAAA,YAChC,UAAU;AAAA,UACb;AAAA,QACrB,CAAiB;AAED,YAAI,SAAS,eAAe,KAAK;AAC7B,iBAAO,kBAAkB,SAAS,IAAI;AACtCA,wBAAAA,MAAI,eAAe,gBAAgB,SAAS,IAAI;AAAA,QACnD;AAAA,MACJ,SAAQ,OAAO;AACZA,sBAAAA,MAAc,MAAA,SAAA,wBAAA,aAAa,KAAK;AAAA,MACnC;AAAA,IACJ;AAAA,EACJ;AAAA,EACD,SAAS;AAAA,IACL,iBAAiB,WAAS,MAAM;AAAA,IAChC,aAAa,WAAS,MAAM;AAAA,IAC5B,aAAa,WAAS,MAAM;AAAA,EAC/B;AACL,CAAC;;"}